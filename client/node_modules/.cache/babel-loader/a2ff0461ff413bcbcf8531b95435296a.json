{"ast":null,"code":"var _jsxFileName = \"/home/nejc/LDSE/SharedManufacturing/client/src/components/misc/TradeModal.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useGlobalContext } from \"../../context/context\";\nimport { FaTimes } from 'react-icons/fa';\nimport Axios from \"axios/index\";\n\nconst TradeModal = () => {\n  const {\n    gameData,\n    isTradeModalOpen,\n    closeTradeModal,\n    tradeModalContent\n  } = useGlobalContext();\n  const [txFee, setTxFee] = useState();\n  const [showAlert, setShowAlert] = useState(false);\n  const [alertContent, setAlertContent] = useState('');\n  const [tableDataArray, setTableDataArray] = useState([]);\n\n  const countDecimals = value => {\n    if (Math.floor(value).toString() === value) return 0;\n    return value.toString().split(\".\")[1].length || 0;\n  };\n\n  const confirm = async () => {\n    try {\n      if (txFee === undefined || txFee === \"\") {\n        setAlertContent('You must enter a value');\n        setShowAlert(true);\n      } else {\n        if (isNaN(txFee) || txFee < 0) {\n          setAlertContent('Input must be a positive number');\n          setShowAlert(true);\n        } else {\n          if (countDecimals(txFee) > 1) {\n            setAlertContent('Input value can have at most one decimal place');\n            setShowAlert(true);\n          } else {\n            if (parseFloat(tradeModalContent.price) + parseFloat(txFee) > gameData.player.balance) {\n              setAlertContent('Price and TxFee is higher than balance');\n              setShowAlert(true);\n            } else {\n              const token = localStorage.getItem(\"auth-token\");\n              const playerId = localStorage.getItem(\"playerId\");\n              const data = {\n                orderId: tradeModalContent._id,\n                txFee: parseFloat(txFee)\n              };\n              const options = {\n                headers: {\n                  Authorization: \"Bearer \" + token\n                }\n              };\n              const createRes = await Axios.post(`http://localhost:8000/player/createTransaction/${playerId}`, data, options);\n              closeTradeModal();\n              setAlertContent('');\n              setShowAlert(false);\n              setTxFee();\n              document.getElementById(\"inputHolder\").value = \"\";\n            }\n          }\n        }\n      }\n    } catch (err) {\n      if (err.response !== undefined && err.response.data.message === \"Trade already exists\") {\n        setAlertContent('Trade with this person already exists');\n        setShowAlert(true);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const renderTableData = async () => {\n      const transactions = await gameData.allPendingTransactions.sort((a, b) => parseInt(b.txFee) - parseInt(a.txFee));\n      const transactionsArray = await Promise.all(transactions.map(async item => {\n        let {\n          consumer,\n          provider,\n          typeOfService,\n          amountOfService,\n          price,\n          txFee\n        } = item;\n        const consumerObject = await gameData.players.filter(player => player._id === consumer);\n        const providerObject = await gameData.players.filter(player => player._id === provider);\n\n        if (!Array.isArray(providerObject) || !providerObject.length) {\n          return {\n            id: item._id,\n            consumer: consumerObject[0].playerName,\n            provider: \"Blockchain\",\n            typeOfService: typeOfService,\n            amountOfService: amountOfService,\n            price: price,\n            txFee: txFee,\n            type: \"cancel transaction\"\n          };\n        }\n\n        return {\n          id: item._id,\n          consumer: consumerObject[0].playerName,\n          provider: providerObject[0].playerName,\n          typeOfService: typeOfService,\n          amountOfService: amountOfService,\n          price: price,\n          txFee: txFee,\n          type: \"cancel transaction\"\n        };\n      }));\n      setTableDataArray(transactionsArray);\n    };\n\n    renderTableData();\n  }, [gameData]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `${isTradeModalOpen ? 'modal-confirm-overlay show-modal-confirm' : 'modal-confirm-overlay'}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-confirm-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }, \"Create Trade\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-confirm-container-data\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 29\n    }\n  }, \"Player: \", tradeModalContent.playerName), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 29\n    }\n  }, \"typeOfService: \", tradeModalContent.typeOfService), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 29\n    }\n  }, \"price: \", tradeModalContent.price)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"txFee\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 29\n    }\n  }, \"Tx Fee\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-input-group-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"txFee\",\n    id: \"inputHolder\",\n    placeholder: \"Enter tx fee\",\n    onChange: e => setTxFee(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 33\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: `${showAlert ? 'modal-input-alert show-modal-input-alert' : 'modal-input-alert'}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 25\n    }\n  }, alertContent)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"table-pending-transactions-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"table\", {\n    className: \"table-pending-transactions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"th\", {\n    className: \"table-pending-transactions-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 33\n    }\n  }, \"No.\"), /*#__PURE__*/React.createElement(\"th\", {\n    className: \"table-pending-transactions-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 33\n    }\n  }, \"Pending transactions\"), /*#__PURE__*/React.createElement(\"th\", {\n    className: \"table-pending-transactions-head\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 33\n    }\n  }, \"Tx Fee\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 29\n    }\n  }, tableDataArray.map((item, index) => /*#__PURE__*/React.createElement(\"tr\", {\n    key: item.id,\n    \"data-tip\": true,\n    \"data-for\": item.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 45\n    }\n  }, index + 1)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 41\n    }\n  }, item.consumer, \" \\u21C6 \", item.provider), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 41\n    }\n  }, item.txFee))))))), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"close-modal-btn\",\n    onClick: () => {\n      closeTradeModal();\n      setAlertContent('');\n      setShowAlert(false);\n      setTxFee();\n      document.getElementById(\"inputHolder\").value = \"\";\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FaTimes, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"confirm-modal-btn\",\n    onClick: confirm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 17\n    }\n  }, \"Confirm\")));\n};\n\nexport default TradeModal;","map":{"version":3,"sources":["/home/nejc/LDSE/SharedManufacturing/client/src/components/misc/TradeModal.js"],"names":["React","useState","useEffect","useGlobalContext","FaTimes","Axios","TradeModal","gameData","isTradeModalOpen","closeTradeModal","tradeModalContent","txFee","setTxFee","showAlert","setShowAlert","alertContent","setAlertContent","tableDataArray","setTableDataArray","countDecimals","value","Math","floor","toString","split","length","confirm","undefined","isNaN","parseFloat","price","player","balance","token","localStorage","getItem","playerId","data","orderId","_id","options","headers","Authorization","createRes","post","document","getElementById","err","response","message","renderTableData","transactions","allPendingTransactions","sort","a","b","parseInt","transactionsArray","Promise","all","map","item","consumer","provider","typeOfService","amountOfService","consumerObject","players","filter","providerObject","Array","isArray","id","playerName","type","e","target","index"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from 'react';\nimport { useGlobalContext} from \"../../context/context\";\nimport { FaTimes } from 'react-icons/fa';\nimport Axios from \"axios/index\";\n\nconst TradeModal = () => {\n    const { gameData, isTradeModalOpen, closeTradeModal, tradeModalContent } = useGlobalContext();\n    const [txFee, setTxFee] = useState();\n    const [showAlert, setShowAlert] = useState(false);\n    const [alertContent, setAlertContent] = useState('');\n    const [tableDataArray, setTableDataArray] = useState([]);\n\n    const countDecimals = (value) => {\n        if(Math.floor(value).toString() === value) return 0;\n        return value.toString().split(\".\")[1].length || 0;\n    };\n\n    const confirm = async () => {\n        try {\n            if (txFee === undefined || txFee === \"\") {\n                setAlertContent('You must enter a value');\n                setShowAlert(true);\n            } else {\n                if (isNaN(txFee) || txFee < 0) {\n                    setAlertContent('Input must be a positive number');\n                    setShowAlert(true);\n                } else {\n                    if (countDecimals(txFee) > 1) {\n                        setAlertContent('Input value can have at most one decimal place');\n                        setShowAlert(true);\n                    } else {\n                        if (parseFloat(tradeModalContent.price)+parseFloat(txFee) > gameData.player.balance) {\n                            setAlertContent('Price and TxFee is higher than balance');\n                            setShowAlert(true);\n                        } else {\n                            const token = localStorage.getItem(\"auth-token\");\n                            const playerId = localStorage.getItem(\"playerId\");\n                            const data = {\n                                orderId: tradeModalContent._id,\n                                txFee: parseFloat(txFee)\n                            };\n                            const options = {\n                                headers: {\n                                    Authorization: \"Bearer \" + token\n                                }\n                            };\n                            const createRes =  await Axios.post(`http://localhost:8000/player/createTransaction/${playerId}`, data, options);\n                            closeTradeModal();\n                            setAlertContent('');\n                            setShowAlert(false);\n                            setTxFee();\n                            document.getElementById(\"inputHolder\").value= \"\";\n                        }\n                    }\n                }\n            }\n        } catch(err) {\n            if (err.response !== undefined && err.response.data.message === \"Trade already exists\") {\n                setAlertContent('Trade with this person already exists');\n                setShowAlert(true);\n            }\n        }\n    };\n\n    useEffect(() => {\n        const renderTableData = async () => {\n            const transactions = await gameData.allPendingTransactions.sort((a, b) => parseInt(b.txFee) - parseInt(a.txFee));\n            const transactionsArray = await Promise.all(transactions.map(async (item) => {\n                let { consumer, provider, typeOfService, amountOfService, price, txFee } = item;\n                const consumerObject = await gameData.players.filter(player => player._id === consumer);\n                const providerObject = await gameData.players.filter(player => player._id === provider);\n                if (!Array.isArray(providerObject) || !providerObject.length) {\n                    return (\n                        {\n                            id: item._id,\n                            consumer: consumerObject[0].playerName,\n                            provider: \"Blockchain\",\n                            typeOfService: typeOfService,\n                            amountOfService: amountOfService,\n                            price: price,\n                            txFee: txFee,\n                            type: \"cancel transaction\"\n                        }\n                    )\n                }\n                return (\n                    {\n                        id: item._id,\n                        consumer: consumerObject[0].playerName,\n                        provider: providerObject[0].playerName,\n                        typeOfService: typeOfService,\n                        amountOfService: amountOfService,\n                        price: price,\n                        txFee: txFee,\n                        type: \"cancel transaction\"\n                    }\n                )\n            }));\n            setTableDataArray(transactionsArray);\n        };\n        renderTableData();\n    }, [gameData]);\n\n    return (\n        <div\n            className={\n                `${isTradeModalOpen ? 'modal-confirm-overlay show-modal-confirm' : 'modal-confirm-overlay'}`\n            }\n        >\n            <div className='modal-confirm-container'>\n                <h3>Create Trade</h3>\n                <div className='modal-confirm-container-data'>\n                    <div>\n                        <ul>\n                            <li>Player: {tradeModalContent.playerName}</li>\n                            <li>typeOfService: {tradeModalContent.typeOfService}</li>\n                            <li>price: {tradeModalContent.price}</li>\n                        </ul>\n                        <div className={\"modal-input-group\"}>\n                            <label htmlFor={\"txFee\"}>Tx Fee</label>\n                            <div className=\"modal-input-group-container\">\n                                <input type={\"text\"} name={\"txFee\"} id={\"inputHolder\"} placeholder={\"Enter tx fee\"} onChange={e => setTxFee(e.target.value)}/>\n                            </div>\n                        </div>\n                        <div className={`${showAlert? 'modal-input-alert show-modal-input-alert' : 'modal-input-alert'}`}>\n                            {alertContent}\n                        </div>\n                    </div>\n                    <div className=\"table-pending-transactions-container\">\n                        <table className=\"table-pending-transactions\">\n                            <thead>\n                            <tr>\n                                <th className=\"table-pending-transactions-head\">No.</th>\n                                <th className=\"table-pending-transactions-head\">Pending transactions</th>\n                                <th className=\"table-pending-transactions-head\">Tx Fee</th>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            {\n                                tableDataArray.map((item, index) => (\n                                    <tr\n                                        key={item.id}\n                                        data-tip data-for={item.id}\n                                    >\n                                        <td><strong>{index + 1}</strong></td>\n                                        <td>\n                                            {item.consumer} &#8646; {item.provider}\n                                        </td>\n                                        <td>{item.txFee}</td>\n                                    </tr>\n                                ))\n                            }\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                <button className='close-modal-btn' onClick={() => {\n                    closeTradeModal();\n                    setAlertContent('');\n                    setShowAlert(false);\n                    setTxFee();\n                    document.getElementById(\"inputHolder\").value= \"\";\n                }}>\n                    <FaTimes></FaTimes>\n                </button>\n                <button className='confirm-modal-btn' onClick={confirm}>Confirm</button>\n            </div>\n        </div>\n    )\n};\n\nexport default TradeModal"]},"metadata":{},"sourceType":"module"}